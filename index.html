<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Warren Puffguin</title>

    <!-- Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Libre+Franklin:wght@400;600&family=Moda:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <!-- Chart.js + date adapter (for time scale) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>

    <style>
      :root {
        --bg: #251b11;
        --bg2: #3e2e1a;
        --text: #f5f5f5;
        --accent: #ad7c47;
        --muted: #9c866d;
        --nav-height: 70px;
      }
      * { box-sizing: border-box; margin: 0; padding: 0; }
      html { font-size: 112.5%; }
      body {
        font-family: "Libre Franklin", sans-serif;
        color: var(--text);
        line-height: 1.6;
        background-color: #2c1d12;
        min-height: 100vh;
      }
      a { color: var(--accent) }
      .bg-lines {
        opacity: 1;
        background-image: linear-gradient(0deg, #2c1d12 50%, #3e2e1a 50%);
        background-size: 10px 10px;
      }
      .navbar {
        height: var(--nav-height);
        display: flex; justify-content: space-between; align-items: center;
        padding: 0 2rem;
        background: transparent; position: sticky; top: 0; z-index: 20; backdrop-filter: blur(20px);
      }
      .logo { font-family: "Moda", serif; font-size: 3rem; color: var(--accent); text-decoration: none; }
      .nav-links { display: flex; gap: 2.5rem; }
      .nav-links a { text-decoration: none; color: var(--text); font-weight: 600; font-size: 1.8rem; line-height: var(--nav-height); }
      .burger { display: none; flex-direction: column; cursor: pointer; }
      .burger div { width: 28px; height: 4px; background: var(--text); margin: 5px 0; }

      .principal {
        position: relative;
        margin-left: calc(50% - 50vw);
        margin-top: calc(-1 * var(--nav-height));
        height: 100vh;
        background: url("Warren_Purrffet_2.png") top center / cover no-repeat;
        box-shadow: none; overflow: hidden;
      }
      .principal::after {
        content: ""; position: absolute; left: 0; right: 0; bottom: 0; height: 32vh;
        background: linear-gradient(to bottom, rgba(0, 0, 0, 0) 0%, #22190ec2 100%); z-index: 3; pointer-events: none;
      }
      .principal::before {
        content: ""; position: absolute; inset: 0;
        background: radial-gradient(circle at center, transparent 60%, #3a2917bb 100%); pointer-events: none; z-index: 2;
      }
      .hero-content { position: absolute; bottom: 3rem; left: 3rem; color: #fff; z-index: 4; text-shadow: 0 2px 8px #19110488; }
      .hero-content h2 { font-family: "Moda", serif; font-size: 5rem; margin-bottom: 1rem; }
      .hero-content p { font-size: 3rem; margin-bottom: 1rem; color: var(--text); }
      .hero-content a {
        display: inline-block; background: var(--accent); color: #fff; padding: 1.5rem 3rem; text-decoration: none;
        font-weight: 600; font-size: 1.8rem; border-radius: 8px; transition: background 0.3s;
      }
      .hero-content a:hover { background: #825527; }

      .section {
        padding: 5.5rem 1rem; width: 100%; display: flex; align-items: flex-start; justify-content: center;
        min-height: 480px; position: relative; z-index: 1; background: transparent; box-shadow: none; border-top: none;
      }
      .section-title {
        text-align: center; font-family: "Moda", serif; font-size: 3rem; color: var(--accent);
        letter-spacing: 1px; margin-bottom: 0; position: absolute; top: 1.7rem; left: 50%; transform: translateX(-50%);
        width: 100%; z-index: 5; background: transparent; pointer-events: none;
      }
      .magazine-table {
        background: linear-gradient(135deg, #362618 60%, #564024 100%);
        box-shadow: 0 8px 60px 0 #271b0a85, 0 4px 64px 0 #3c2b1d33;
        border-radius: 40px; border: 1.5px solid #85633bcc; background-blend-mode: lighten;
        width: 900px; max-width: 1000px; min-height: 500px; display: flex; align-items: center; justify-content: center;
        position: absolute; right: 10%; top: 200px; z-index: 1; pointer-events: none; padding: 80px; font-size: 32px;
      }
      .magazines { position: absolute; left: 11%; top: 200px; width: 900px; height: 430px; display: flex; align-items: center; justify-content: flex-start; pointer-events: none; z-index: 2; }
      .magazines img {
        box-shadow: 0 8px 32px #000a, 0 2px 8px #0005; border-radius: 12px; position: absolute; transition: transform 0.4s cubic-bezier(0.26, 2, 0.46, 0.71);
        width: 310px; height: 420px; object-fit: cover; background: #eee; border: 3px solid #bba580; filter: sepia(0.16) contrast(1.08) brightness(0.97) saturate(0.82);
      }
      .magazines img:nth-child(1) { left: 20px; top: 35px; transform: rotate(-8deg) scale(1.06); z-index: 2; }
      .magazines img:nth-child(2) { left: 140px; top: 0; transform: rotate(6deg) scale(1.1); z-index: 3; }
      .magazines img:nth-child(3) { left: 270px; top: 60px; transform: rotate(-4deg) scale(1.03); z-index: 1; }

      @media (max-width: 1000px) {
        .magazine-table { max-width: 98vw; width: 98vw; }
        .magazines img { width: 210px; height: 285px; }
        .magazines { height: 310px; width: 350px; }
        .magazines img:nth-child(1) { left: 0; top: 20px; }
        .magazines img:nth-child(2) { left: 90px; top: 0; }
        .magazines img:nth-child(3) { left: 175px; top: 35px; }
        .magazine-table { min-width: 350px; }
      }
      @media (max-width: 650px) {
        .magazine-table { max-width: 100vw; min-width: 120px; min-height: 120px; padding: 1rem 0; }
        .magazines { height: 180px; width: 120px; }
        .magazines img { width: 100px; height: 140px; }
        .magazines img:nth-child(1) { left: 0; top: 10px; }
        .magazines img:nth-child(2) { left: 44px; top: 0; }
        .magazines img:nth-child(3) { left: 80px; top: 22px; }
        .magazine-table { min-width: 120px; }
        .section-title { top: 1.2rem; font-size: 1.3rem; }
      }

      footer { text-align: center; margin: 4rem 0; font-size: 1.1rem; color: var(--muted); }

      @media (max-width: 768px) {
        .nav-links {
          display: none; position: absolute; top: var(--nav-height); right: 1rem; background: rgba(0, 0, 0, 0.9);
          flex-direction: column; border-radius: 6px; box-shadow: 0 4px 16px rgba(0, 0, 0, 0.6); overflow: hidden;
        }
        .nav-links.open { display: flex; }
        .burger { display: flex; }
        .section-title { font-size: 2rem; }
      }

      .testimonial-container { display: flex; flex-wrap: wrap; justify-content: center; gap: 24px; padding: 0 16px; margin-top: 64px; }
      .testimonial-card {
        background: linear-gradient(135deg, #362618 60%, #564024 100%);
        box-shadow: 0 8px 60px 0 #271b0a85, 0 4px 64px 0 #3c2b1d33;
        border-radius: 40px; border: 1.5px solid #85633bcc; background-blend-mode: lighten;
        padding: 24px; max-width: 400px; width: 100%; position: relative; display: flex; flex-direction: column; justify-content: space-between;
      }
      .quote-icon { width: 24px; height: 24px; margin-bottom: 16px; opacity: 0.3; }
      .testimonial-text { font-size: 16px; line-height: 1.5; color: #fff; margin-bottom: 24px; }
      .profile-section { display: flex; align-items: center; gap: 12px; }
      .profile-image { width: 48px; height: 48px; border-radius: 50%; object-fit: cover; }
      .profile-info { display: flex; flex-direction: column; }
      .profile-name { font-size: 16px; font-weight: 600; color: #aaa; margin-bottom: 2px; }
      .profile-handle { font-size: 14px; color: #fff; }
      @media (max-width: 480px) {
        .testimonial-card { margin: 0 16px; padding: 20px; }
        .testimonial-text { font-size: 15px; }
      }
    </style>
  </head>

  <body class="bg-lines">
    <nav class="navbar">
      <a href="/" class="logo">Warren Puffguin</a>
      <div class="nav-links" id="navLinks">
        <a href="https://x.com/Warren_Puffguin" target="_blank">Twitter</a>
        <a href="#articles">Articles</a>
        <a href="#memecoin">Chart</a>
        <a href="#puffguin-vs-nasdaq">Compare</a>
        <a href="#testimonials">Testimonials</a>
      </div>
      <div class="burger" id="burger">
        <div></div><div></div><div></div>
      </div>
    </nav>

    <section class="principal">
      <div class="hero-content">
        <h2>The Penguin Investor</h2>
        <p>amasses a fortune on crypto market</p>
        <a href="">Start Now</a>
      </div>
    </section>

    <!-- Articles -->
    <section class="section" id="articles">
      <div style="width: 100%; position: relative; min-height: 700px">
        <h2 class="section-title">Who is Warren Puffguin?</h2>
        <div class="magazines">
          <img src="feline.png" alt="Warren Puffguin Magazine 1" />
          <img src="time.png" alt="Warren Puffguin Magazine 2" />
          <img src="biogra.png" alt="Warren Puffguin Magazine 3" />
        </div>
        <div class="magazine-table">
          Oh, he’s the cold-blooded… wait, actually warm-blooded… financial genius of the Antarctic! Known for waddling into boardrooms in his little tuxedo, Warren Puffguin built his empire on fish futures, iceberg real estate, and the occasional krill IPO. He’s the only investor who measures market dips in degrees below freezing and gives investment tips while sliding on his belly.
        </div>
      </div>
    </section>

    <!-- $PUFFGUIN Chart (mock or API-ready) -->
    <section class="section" id="memecoin">
      <h2 class="section-title">$PUFFGUIN — Price Chart</h2>
      <div style="width: min(1000px, 92vw); margin-top: 5rem; display:grid; gap:1rem;">
        <!-- Controls -->
        <div style="display:flex; gap:1rem; flex-wrap:wrap; align-items:center; justify-content:flex-end;">
          <label>
            <span style="margin-right:8px; color:var(--muted)">Timeframe</span>
            <select id="tf" style="background:#2e2115;color:#fff;border:1.5px solid #85633bcc;border-radius:10px;padding:8px 12px;">
              <option value="24h">24h</option>
              <option value="7d" selected>7d</option>
              <option value="30d">30d</option>
            </select>
          </label>
          <label>
            <span style="margin-right:8px; color:var(--muted)">Scale</span>
            <select id="scale" style="background:#2e2115;color:#fff;border:1.5px solid #85633bcc;border-radius:10px;padding:8px 12px;">
              <option value="linear" selected>Linear</option>
              <option value="logarithmic">Logarithmic</option>
            </select>
          </label>
        </div>
        <!-- Canvas -->
        <div style="background:linear-gradient(135deg,#362618 60%,#564024 100%); border:1.5px solid #85633bcc; border-radius:24px; box-shadow:0 8px 60px #271b0a85, 0 4px 64px #3c2b1d33; padding:16px;">
          <canvas id="memecoinChart" height="120"></canvas>
        </div>
        <!-- Stats -->
        <div id="memecoinStats" style="display:flex; gap:1.5rem; flex-wrap:wrap;"></div>
      </div>
    </section>

    <!-- Comparison: $PUFFGUIN vs Nasdaq -->
    <section class="section" id="puffguin-vs-nasdaq">
      <h2 class="section-title">$PUFFGUIN vs Nasdaq</h2>
      <div style="width:min(1100px,92vw);margin-top:5rem;display:grid;gap:1.25rem;">
        <!-- Controls -->
        <div style="display:flex;gap:1rem;flex-wrap:wrap;align-items:center;justify-content:space-between">
          <div style="display:flex;gap:1rem;flex-wrap:wrap;align-items:center">
            <div>
              <label style="color:var(--muted);font-size:.9rem;">Circulating Supply</label><br/>
              <input id="supplyInput" type="number" min="1" step="1" value="1000000000" readonly
                     style="background:#2e2115;color:#fff;border:1.5px solid #85633bcc;border-radius:10px;padding:8px 12px;width:220px;">
              <div style="color:var(--muted);font-size:.8rem;margin-top:.25rem;">Fixed at 1,000,000,000</div>
            </div>
            <div>
              <label style="color:var(--muted);font-size:.9rem;">Target Market Cap (Nasdaq)</label><br/>
              <input id="targetCapInput" type="number" step="1" value="25000000000000"
                     style="background:#2e2115;color:#fff;border:1.5px solid #85633bcc;border-radius:10px;padding:8px 12px;width:280px;">
              <div style="color:var(--muted);font-size:.8rem;margin-top:.25rem;">
                Example: 25,000,000,000,000 = $25T (edit as you wish)
              </div>
            </div>
          </div>
          <div style="display:flex;gap:1rem;flex-wrap:wrap;align-items:center;">
            <label>
              <span style="margin-right:8px;color:var(--muted)">Timeframe</span>
              <select id="cmpTf" style="background:#2e2115;color:#fff;border:1.5px solid #85633bcc;border-radius:10px;padding:8px 12px;">
                <option value="24h">24h</option>
                <option value="7d" selected>7d</option>
                <option value="30d">30d</option>
              </select>
            </label>
          </div>
        </div>

        <!-- Cards -->
        <div id="cmpStats" style="display:flex;gap:1rem;flex-wrap:wrap;"></div>

        <!-- Normalized comparison chart -->
        <div style="background:linear-gradient(135deg,#362618 60%,#564024 100%);border:1.5px solid #85633bcc;border-radius:24px;box-shadow:0 8px 60px #271b0a85,0 4px 64px 0 #3c2b1d33;padding:16px;">
          <canvas id="cmpChart" height="120"></canvas>
        </div>
        <div style="color:var(--muted);font-size:.85rem;">
          Both lines are normalized to 100 at the start to compare relative performance. This demo uses mock data unless you connect real APIs.
        </div>
      </div>
    </section>

    <!-- Testimonials -->
    <section class="section" id="testimonials">
      <h2 class="section-title">Testimonials</h2>
      <div class="testimonial-container">
        <div class="testimonial-card">
          <svg class="quote-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
          </svg>
          <p class="testimonial-text">
            When I met Warren Puffguin, I was just another penguin fishing for luck. Now, thanks to his ice-cold investment strategies, my fish stocks have tripled. Literally. I have three fish for every one I used to catch.
          </p>
          <div class="profile-section">
            <img src="/testimonial-1.png" alt="Penny Gentoo" class="profile-image"/>
            <div class="profile-info">
              <div class="profile-name">Penny Gentoo</div>
              <div class="profile-handle">Owner of ChillFish Co.</div>
            </div>
          </div>
        </div>

        <div class="testimonial-card">
          <svg class="quote-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
          </svg>
          <p class="testimonial-text">
            Warren told me to put my savings into iceberg condos. I thought he’d gone a bit loony, but now every penguin in the colony is paying me rent in krill. Best move since my first belly slide.
          </p>
          <div class="profile-section">
            <img src="/testimonial-2.png" alt="Mako Macaroni" class="profile-image"/>
            <div class="profile-info">
              <div class="profile-name">Mako Macaroni</div>
              <div class="profile-handle">Real Estate Penguin</div>
            </div>
          </div>
        </div>

        <div class="testimonial-card">
          <svg class="quote-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
          </svg>
          <p class="testimonial-text">
            Other advisors talk numbers. Warren talks tides, migration patterns, and herring trends. I’ve never seen profits this high or ice this thick in my life.
          </p>
          <div class="profile-section">
            <img src="/testimonial-3.png" alt="Adelie Adelson" class="profile-image"/>
            <div class="profile-info">
              <div class="profile-name">Adelie Adelson</div>
              <div class="profile-handle">Serial Entrepreneur Penguin</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <p>
        &copy; 2025 Warren Puffguin • Follow us on
        <a href="https://x.com/Warren_Puffguin" target="_blank">Twitter</a>
      </p>
    </footer>

    <!-- Scripts -->
    <script>
      // Mobile burger
      document.getElementById("burger")?.addEventListener("click", () => {
        document.getElementById("navLinks").classList.toggle("open");
      });

      // ========= $PUFFGUIN Price Chart =========
      const TOKEN_SYMBOL = 'PUFFGUIN';
      const QUOTE = 'USD';
      const CURRENCY_SIGN = '$';
      const DECIMALS = 6;
      const API_URL = null; // Set your endpoint returning a time series, or leave null to use mock

      function generateMockSeries(range) {
        const now = Date.now();
        const points = range === '24h' ? 24 : range === '7d' ? 7 * 24 : 30 * 24;
        let price = 0.002; // base mock price
        const labels = [];
        const data = [];
        for (let i = points; i >= 0; i--) {
          const t = new Date(now - i * 60 * 60 * 1000);
          const drift = (Math.sin(i / 18) + Math.cos(i / 11)) * 0.00002;
          const noise = (Math.random() - 0.5) * 0.00003;
          price = Math.max(0.0002, price + drift + noise);
          labels.push(t);
          data.push(+price.toFixed(6));
        }
        return { labels, data };
      }

      async function fetchFromAPI(range) {
        const params = new URLSearchParams({ range });
        const url = API_URL?.includes('?') ? `${API_URL}&${params}` : `${API_URL}?${params}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error('Failed to load price feed');
        const raw = await res.json();
        // expected: [{ts:<unix_ms>, close:<number>}, ...]
        return { labels: raw.map(p => new Date(p.ts)), data: raw.map(p => Number(p.close)) };
      }

      const fmtPrice = (v) => `${CURRENCY_SIGN}${Number(v).toLocaleString(undefined, { maximumFractionDigits: 8 })}`;
      const fmtPct = (v) => `${(v >= 0 ? '+' : '')}${v.toFixed(2)}%`;

      const ctx = document.getElementById('memecoinChart').getContext('2d');
      let chart;

      function gradientStroke(ctx, area) {
        const gradient = ctx.createLinearGradient(0, area.top, 0, area.bottom);
        gradient.addColorStop(0, '#ad7c47');
        gradient.addColorStop(1, '#9c866d');
        return gradient;
      }
      function gradientFill(ctx, area) {
        const g = ctx.createLinearGradient(0, area.top, 0, area.bottom);
        g.addColorStop(0, 'rgba(173,124,71,0.25)');
        g.addColorStop(1, 'rgba(156,134,109,0.02)');
        return g;
      }

      async function loadSeries(range) {
        try {
          if (API_URL) return await fetchFromAPI(range);
          return generateMockSeries(range);
        } catch (e) {
          console.error(e);
          return generateMockSeries(range);
        }
      }

      function updateStats(labels, data) {
        const last = data[data.length - 1];
        const first = data[0];
        const change = ((last - first) / first) * 100;

        const supply = 1_000_000_000; // fixed supply here for info cards (not used in this chart)
        const mcap = last * supply;
        const vol = (Math.abs(change) / 100) * mcap * 0.12; // mock volume
        const stats = [
          { label: 'Price', value: fmtPrice(last) },
          { label: 'Change', value: fmtPct(change) },
          { label: 'Market Cap (est.)', value: `${CURRENCY_SIGN}${mcap.toLocaleString(undefined, { maximumFractionDigits: 0 })}` },
          { label: 'Volume (est.)', value: `${CURRENCY_SIGN}${vol.toLocaleString(undefined, { maximumFractionDigits: 0 })}` },
        ];

        const el = document.getElementById('memecoinStats');
        el.innerHTML = '';
        for (const s of stats) {
          const card = document.createElement('div');
          card.style.background = 'linear-gradient(135deg,#362618 60%,#564024 100%)';
          card.style.border = '1.5px solid #85633bcc';
          card.style.boxShadow = '0 8px 60px #271b0a85, 0 4px 64px #3c2b1d33';
          card.style.borderRadius = '16px';
          card.style.padding = '12px 16px';
          card.style.minWidth = '180px';
          card.innerHTML = `<div style="color:var(--muted);font-size:.9rem;">${s.label}</div>
                            <div style="font-size:1.2rem;color:#fff;font-weight:600;">${s.value}</div>`;
          el.appendChild(card);
        }
      }

      async function render(range = '7d', yScale = 'linear') {
        const { labels, data } = await loadSeries(range);
        updateStats(labels, data);

        if (chart) chart.destroy();
        chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels,
            datasets: [{
              label: `${TOKEN_SYMBOL}/${QUOTE}`,
              data,
              fill: true,
              tension: 0.35,
              borderWidth: 2.5,
              pointRadius: 0,
              segment: { borderColor: (ctx) => {
                const { p0, p1 } = ctx.segment;
                return p1.parsed.y >= p0.parsed.y ? '#ad7c47' : '#9c866d';
              }},
              borderColor: '#ad7c47',
              backgroundColor: (c) => gradientFill(c.chart.ctx, c.chart.chartArea),
            }]
          },
          options: {
            maintainAspectRatio: false,
            scales: {
              x: {
                type: 'time',
                time: { tooltipFormat: 'MMM d, HH:mm' },
                grid: { color: 'rgba(255,255,255,0.08)' },
                ticks: { color: '#eee' }
              },
              y: {
                type: yScale,
                grid: { color: 'rgba(255,255,255,0.06)' },
                ticks: {
                  color: '#eee',
                  callback: (v) => fmtPrice(v)
                }
              }
            },
            plugins: {
              legend: { display: false },
              tooltip: {
                mode: 'index',
                intersect: false,
                callbacks: {
                  label: (ctx) => `${TOKEN_SYMBOL}: ${fmtPrice(ctx.parsed.y)}`
                }
              }
            },
            interaction: { intersect: false, mode: 'index' },
          }
        });

        const area = chart.chartArea;
        chart.data.datasets[0].borderColor = gradientStroke(chart.ctx, area);
        chart.update();
      }

      const tf = document.getElementById('tf');
      const scaleSel = document.getElementById('scale');
      tf?.addEventListener('change', () => render(tf.value, scaleSel.value));
      scaleSel?.addEventListener('change', () => render(tf.value, scaleSel.value));
      setInterval(() => render(tf.value || '7d', scaleSel.value || 'linear'), 60_000);
      render();

      // ========= Comparison: $PUFFGUIN vs Nasdaq =========
      const PUFF_PRICE_API = null; // Your backend endpoint returning: { price: <number> }
      const NASDAQ_SERIES_API = null; // Your backend endpoint returning: [{ ts:<unix_ms>, value:<number> }, ...]

      function mockPuffPrice() {
        return +(0.002 + (Math.random() - 0.5) * 0.0006).toFixed(6);
      }
      function mockSeries(range, base, vol = 1.0) {
        const now = Date.now();
        const points = range === '24h' ? 24 : range === '7d' ? 7 * 24 : 30 * 24;
        let v = base;
        const labels = [];
        const data = [];
        for (let i = points; i >= 0; i--) {
          const t = new Date(now - i * 60 * 60 * 1000);
          const drift = (Math.sin(i / 16) + Math.cos(i / 10)) * 0.15 * vol;
          const noise = (Math.random() - 0.5) * 0.6 * vol;
          v = Math.max(1, v + drift + noise);
          labels.push(t);
          data.push(+v.toFixed(2));
        }
        return { labels, data };
      }
      async function fetchPuffPrice() {
        try {
          if (!PUFF_PRICE_API) return mockPuffPrice();
          const r = await fetch(PUFF_PRICE_API);
          if (!r.ok) throw new Error('Price API error');
          const j = await r.json();
          return Number(j.price);
        } catch (e) {
          console.warn(e);
          return mockPuffPrice();
        }
      }
      async function fetchNasdaqSeries(range) {
        try {
          if (!NASDAQ_SERIES_API) {
            return mockSeries(range, 15000, 0.4);
          }
          const url = NASDAQ_SERIES_API + (NASDAQ_SERIES_API.includes('?') ? `&range=${range}` : `?range=${range}`);
          const r = await fetch(url);
          if (!r.ok) throw new Error('Nasdaq API error');
          const raw = await r.json();
          return { labels: raw.map(p => new Date(p.ts)), data: raw.map(p => Number(p.value)) };
        } catch (e) {
          console.warn(e);
          return mockSeries(range, 15000, 0.4);
        }
      }
      async function buildPuffSeries(range, lastPrice) {
        const base = lastPrice * 10000;
        const ser = mockSeries(range, base, 0.9);
        ser.data[ser.data.length - 1] = +(lastPrice * 10000).toFixed(2);
        return ser;
      }

      const fmtMoney = (n, max = 2) => `${CURRENCY_SIGN}${Number(n).toLocaleString(undefined,{ maximumFractionDigits: max })}`;
      const fmtNum = (n, max = 2) => `${Number(n).toLocaleString(undefined,{ maximumFractionDigits: max })}`;
      const pctFmt = (x) => `${(x >= 0 ? '+' : '')}${x.toFixed(2)}%`;

      function statCard(label, value) {
        const d = document.createElement('div');
        d.style.background = 'linear-gradient(135deg,#362618 60%,#564024 100%)';
        d.style.border = '1.5px solid #85633bcc';
        d.style.boxShadow = '0 8px 60px #271b0a85, 0 4px 64px #3c2b1d33';
        d.style.borderRadius = '16px';
        d.style.padding = '12px 16px';
        d.style.minWidth = '200px';
        d.innerHTML = `<div style="color:var(--muted);font-size:.9rem;">${label}</div>
                       <div style="font-size:1.2rem;color:#fff;font-weight:600;">${value}</div>`;
        return d;
      }

      function normalizeSeries(data) {
        if (!data.length) return [];
        const base = data[0];
        return data.map(v => (v / base) * 100);
      }

      const cmpCtx = document.getElementById('cmpChart').getContext('2d');
      let cmpChart;

      async function renderComparison(range = '7d') {
        const supplyEl = document.getElementById('supplyInput');
        const targetEl = document.getElementById('targetCapInput');
        const supply = Math.max(1, Number(supplyEl.value || 0));        // fixed to 1,000,000,000 (readonly)
        const targetCap = Math.max(1, Number(targetEl.value || 0));     // editable

        const puffPrice = await fetchPuffPrice();
        const puffCap = puffPrice * supply;
        const gap = Math.max(0, targetCap - puffCap);
        const targetPrice = targetCap / supply;
        const multiple = puffPrice > 0 ? targetPrice / puffPrice : Infinity;
        const increasePct = puffPrice > 0 ? (multiple - 1) * 100 : Infinity;

        const stats = document.getElementById('cmpStats');
        stats.innerHTML = '';
        stats.appendChild(statCard('$PUFFGUIN Price', fmtMoney(puffPrice, 8)));
        stats.appendChild(statCard('Circulating Supply', fmtNum(supply, 0)));
        stats.appendChild(statCard('$PUFFGUIN Market Cap', fmtMoney(puffCap, 0)));
        stats.appendChild(statCard('Target (Nasdaq) Market Cap', fmtMoney(targetCap, 0)));
        stats.appendChild(statCard('Gap to Target', fmtMoney(gap, 0)));
        stats.appendChild(statCard('Target Price to Match', fmtMoney(targetPrice, 8)));
        stats.appendChild(statCard('Increase Needed', isFinite(increasePct) ? pctFmt(increasePct) : '∞'));

        const nasdaq = await fetchNasdaqSeries(range);
        const puff = await buildPuffSeries(range, puffPrice);
        const labels = nasdaq.labels.length >= puff.labels.length ? nasdaq.labels : puff.labels;

        const datasetPuff = normalizeSeries(puff.data);
        const datasetNasdaq = normalizeSeries(nasdaq.data);

        if (cmpChart) cmpChart.destroy();
        cmpChart = new Chart(cmpCtx, {
          type: 'line',
          data: {
            labels,
            datasets: [
              {
                label: `$${TOKEN_SYMBOL} (normalized)`,
                data: datasetPuff,
                borderWidth: 2.5,
                pointRadius: 0,
                fill: false,
                borderColor: '#ad7c47'
              },
              {
                label: 'Nasdaq (normalized)',
                data: datasetNasdaq,
                borderWidth: 2.5,
                pointRadius: 0,
                fill: false,
                borderColor: '#9c866d'
              }
            ]
          },
          options: {
            maintainAspectRatio: false,
            scales: {
              x: {
                type: 'time',
                time: { tooltipFormat: 'MMM d, HH:mm' },
                grid: { color: 'rgba(255,255,255,0.08)' },
                ticks: { color: '#eee' }
              },
              y: {
                grid: { color: 'rgba(255,255,255,0.06)' },
                ticks: { color: '#eee', callback: (v) => `${v.toFixed(0)}` }
              }
            },
            interaction: { intersect: false, mode: 'index' },
            plugins: { legend: { labels: { color: '#eee' } } }
          }
        });
      }

      const cmpTf = document.getElementById('cmpTf');
      document.getElementById('targetCapInput')?.addEventListener('input', () => renderComparison(cmpTf.value));
      cmpTf?.addEventListener('change', () => renderComparison(cmpTf.value));
      setInterval(() => renderComparison(cmpTf.value || '7d'), 60_000);
      renderComparison('7d');
    </script>
  </body>
</html>
